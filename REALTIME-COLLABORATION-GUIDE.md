# 🎵 SyncSphere 实时协作使用指南

## 🌟 功能概述

SyncSphere 现已实现完整的实时协作功能！多个用户可以在同一个房间内：
- ✅ **实时轨道拖拽同步** - 在 Mixer 中拖拽 Channel Strip 轨道重排
- ✅ **实时音量调节同步** - 调节 Volume Slider 音量参数
- ✅ **实时声相调节同步** - 调节 Pan Knob 声相参数
- ✅ **30秒自动快照保存** - 定期保存项目状态到数据库
- ✅ **刷新后状态恢复** - 断线重连后自动恢复协作状态

当用户1进行任何操作时，所有其他用户都会立即看到相同的界面变化！

## 🚀 启动协作功能

### 1. 启动应用服务器
```bash
npm run opendaw:start
```

### 2. 打开多个浏览器窗口
在不同的浏览器窗口中打开以下URL（注意不同的userId）：

**用户1:**
```
http://localhost:3000/studio/opendaw?projectId=my-project&userId=user1&collaborative=true&userName=Alice
```

**用户2:**
```
http://localhost:3000/studio/opendaw?projectId=my-project&userId=user2&collaborative=true&userName=Bob
```

## 🎯 测试实时协作

1. **创建轨道**: 在任一窗口中创建音频轨道
2. **拖拽轨道**: 拖拽轨道到新位置
3. **观察同步**: 在另一个窗口中观察轨道是否实时移动到相同位置

## 📊 协作状态指示

### 连接状态
- ✅ **已连接**: 绿色指示器，实时协作正常
- ⚠️ **连接中**: 黄色指示器，正在建立连接
- ❌ **断开**: 红色指示器，协作功能不可用

### 用户在线状态
- 在界面右上角可以看到当前房间内的在线用户列表
- 每个用户有不同的颜色标识

## 🔧 高级功能

### 所有权管理
- 每个轨道有明确的所有者
- 只有轨道所有者可以编辑该轨道
- 创建轨道的用户自动成为所有者

### 实时同步范围
- ✅ **轨道位置** - 拖拽位置实时同步
- ✅ **轨道创建/删除** - 立即同步
- ✅ **轨道属性** - 音量、静音等
- ⏳ **音频播放状态** - 计划中功能

## 🛠️ 故障排除

### 协作功能无法启动
1. 检查URL参数是否正确包含 `collaborative=true`
2. 确保 `projectId` 和 `userId` 参数存在且不同
3. 检查控制台是否有WebSocket连接错误

### 无法看到其他用户的操作
1. 确认两个用户使用相同的 `projectId`
2. 检查网络连接
3. 刷新页面重新建立连接

### 轨道拖拽不同步
1. 检查控制台是否有实时同步错误日志
2. 确认轨道所有权（只有所有者的操作会被同步）
3. 检查WebSocket连接状态

## 📈 性能说明

### 节流机制
- 位置更新每100ms批量发送，避免网络拥塞
- 自动合并连续的位置变化

### 网络优化
- 只同步必要的变更数据
- 智能的消息去重机制
- 断线自动重连

## 🧪 测试工具

### 自动化测试
运行内置的协作功能测试：
```bash
node test-realtime-collaboration.js
```

### 手动测试清单
- [ ] 创建轨道后其他用户能看到
- [ ] 拖拽轨道位置能实时同步
- [ ] 删除轨道后其他用户界面更新
- [ ] 多用户同时操作不同轨道
- [ ] 网络断开重连后同步恢复

## 🔮 未来功能

### 计划中的协作功能
- 🎵 **音频播放同步** - 多用户同步播放
- 🎨 **光标位置共享** - 看到其他用户的操作位置
- 💬 **实时聊天** - 房间内文字交流
- 📝 **操作历史** - 撤销/重做跨用户同步
- 🎯 **精细权限控制** - 更灵活的编辑权限

### 技术改进
- 更高效的差分同步算法
- 音频流实时传输
- 移动端支持优化

---

## 🆘 需要帮助？

如果遇到问题，请检查：
1. 浏览器控制台的错误信息
2. 网络连接状态
3. 服务器运行状态

**技术支持**: 查看项目文档或提交Issue到项目仓库