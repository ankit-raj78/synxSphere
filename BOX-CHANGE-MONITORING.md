# Box 变化监听功能使用说明

## 功能说明

我已经在 `synxsphere-integration.ts` 中添加了 `startMonitoringBoxChanges` 函数，它可以实时监听并打印所有 Box 的变化，包括：

- **新建 Box** - 显示新创建的 Box 的名称和 UUID
- **原始值更新** - 显示哪个字段被修改，以及新旧值
- **指针更新** - 显示指针字段的变化（如引用关系的改变）
- **删除 Box** - 显示被删除的 Box 的信息

## 使用方法

### 开始监听

在浏览器控制台运行：

```javascript
startMonitoringBoxChanges()
```

### 停止监听

在浏览器控制台运行：

```javascript
stopMonitoringBoxChanges()
```

## 输出示例

```
🔍 开始监听 Box 变化...
✅ Box 变化监听已启动
💡 提示: 在控制台运行 stopMonitoringBoxChanges() 来停止监听

==================================================
📦 Box 更新检测到！
==================================================
🆕 类型: 新建 Box
   名称: NoteRegionBox
   UUID: 12345678-1234-1234-1234-123456789012
   设置大小: 128 bytes
==================================================

==================================================
📦 Box 更新检测到！
==================================================
✏️ 类型: 原始值更新
   地址: [object Address]
   Box UUID: 23456789-2345-2345-2345-234567890123
   字段: 2,0
   旧值: 0
   新值: 1920
   Box 名称: NoteRegionBox
   Box 类型: NoteRegionBox
==================================================

==================================================
📦 Box 更新检测到！
==================================================
🔗 类型: 指针更新
   地址: [object Address]
   Box UUID: 34567890-3456-3456-3456-345678901234
   字段: 3
   旧指向: null
   新指向: 45678901-4567-4567-4567-456789012345
==================================================
```

## 用于权限系统调试

这个功能对于调试轨道权限系统特别有用，因为它可以：

1. **实时追踪修改** - 每当用户进行任何操作时，立即显示被修改的 Box UUID
2. **识别修改类型** - 区分是新建、修改还是删除操作
3. **查看字段变化** - 显示具体哪个字段被修改了
4. **获取 Box 信息** - 尝试显示 Box 的名称和类型

### 与权限系统集成

您可以使用这些信息来：

1. **获取被修改的 Box UUID**
   - 对于 `new` 类型：`update.uuid`
   - 对于 `primitive` 和 `pointer` 类型：`update.address.uuid`
   - 对于 `delete` 类型：`update.uuid`

2. **追踪到 TrackBox**
   - 使用 Box UUID 查找其父 TrackBox
   - 检查用户是否有权限修改该 TrackBox

3. **实时权限检查**
   - 在检测到修改时立即进行权限验证
   - 如果没有权限，可以阻止修改或显示警告

## 注意事项

- 监听函数会捕获**所有**的 Box 变化，包括系统自动的更新
- 在繁忙的编辑会话中，可能会产生大量的日志输出
- 记得在不需要时停止监听，以避免性能影响 